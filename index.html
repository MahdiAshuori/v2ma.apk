<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>V2MA APP</title>
    <!-- ØªÙˆØ¬Ù‡: Ú©Ø¯ ØªØ§ÛŒÙ…Ø± Ø§Ø² Ø§ÛŒÙ†Ø¬Ø§ Ø­Ø°Ù Ø´Ø¯ -->
    <script src="https://cdn.tailwindcss.com">
    </script>
    <script defer="" src="https://unpkg.com/html5-qrcode"></script>
    <script defer="" src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <!-- ====== Extracted & Renamed CSS (keeps original look) ====== -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', sans-serif; }
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            min-height: 100vh;
        }
        /* glass-effect  -> .g */
        .g {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        /* config-card -> .cc */
        .cc {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 1px solid rgba(148, 163, 184, 0.3);
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            position: relative;
        }
        .cc:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border-color: rgba(59, 130, 246, 0.5);
        }
        /* status-indicator -> .si */
        .si {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px currentColor;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        /* tab-active -> .ta */
        .ta {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        /* speed-meter -> .sm */
        .sm {
            background: conic-gradient(from 0deg, #ef4444, #f97316, #eab308, #22c55e);
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
        }
        /* ping classes -> .p-ex, .p-good, .p-fair, .p-poor, .p-timeout, .p-testing */
        .p-ex { color: #22c55e; text-shadow: 0 0 10px #22c55e; }
        .p-good { color: #eab308; text-shadow: 0 0 10px #eab308; }
        .p-fair { color: #f97316; text-shadow: 0 0 10px #f97316; }
        .p-poor { color: #ef4444; text-shadow: 0 0 10px #ef4444; }
        .p-timeout { color: #94a3b8; }
        .p-testing { animation: blink 1s infinite; color: #06b6d4 !important; }
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0.3; } }
        /* neon-button -> .nb */
        .nb { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); transition: all 0.3s ease; }
        .nb:hover { box-shadow: 0 0 30px rgba(59, 130, 246, 0.6); transform: translateY(-2px); }
        /* header-gradient -> .hg */
        .hg {
            background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }
        /* menu-panel -> .mp, menu-item -> .mi */
        .mp {
            position: absolute;
            min-width: 180px;
            background: rgba(15, 23, 42, 0.98);
            border: 1px solid rgba(148,163,184,.2);
            border-radius: 12px;
            padding: 6px;
            box-shadow: 0 10px 30px rgba(0,0,0,.4);
            z-index: 1000;
        }
        .mi {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            border-radius: 8px;
            color: #e2e8f0;
            cursor: pointer;
            white-space: nowrap;
        }
        .mi:hover { background: rgba(148,163,184,.1); }
        /* Selection bar (keeps id #selectionBar) */
        #selectionBar { display: none; position: sticky; top: 0; z-index: 40; padding: 8px; margin-bottom: 12px; }
        /* card-actions -> .ca, card-menu-btn -> .cmb, top-actions -> .tacts, bulk-menu-btn -> .bmb */
        .ca { display: flex; gap: 8px; align-items: center; }
        .cmb { display: none; }
        .tacts { display: flex; }
        .bmb { display: none; }
        @media (max-width: 700px) {
            .ca { display: none !important; }
            .cmb { display: inline-flex !important; }
            .tacts { display: none !important; }
            .bmb { display: inline-flex !important; }
        }
        /* icon-btn -> .ib */
        .ib {
            background: rgba(148,163,184,.12);
            border: 1px solid rgba(148,163,184,.2);
            color: #e2e8f0;
            padding: 8px 10px;
            border-radius: 10px;
            transition: .2s;
        }
        .ib:hover { background: rgba(148,163,184,.2); }
        /* titlebox -> .tbx, apktitle -> .apt */
        .tbx {
            justify-items: center;
            align-content: center;
            text-align: center;
            background: linear-gradient(120deg,rgb(61, 128, 244), rgb(137, 92, 244));
            border: 2px solid rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            width: 230px;
            position: relative;
            right: 50%;
            transform: translateX(50%);
        }
        .apt {
            direction: rtl;
            text-align: center;
            color: rgb(255, 255, 255);
            font-size: 30px;
            text-shadow: 0px 3px 5px rgb(0, 0, 0);
        }
        /* action menu small tweaks (matching original) */
        .menu-panel .mi + .mi { margin-top: 4px; }
        /* Ù†Ø§Ù… Ú©Ø§Ù†ÙÛŒÚ¯ - Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ú©Ø§Ø±Ø§Ú©ØªØ± Ùˆ Ú©ÙˆØªØ§Ù‡â€ŒØ³Ø§Ø²ÛŒ */
        .config-name {
            display: block;
            max-width: 100%;     /* Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø¹Ø±Ø¶ Ú©Ø§Ø±Øª */
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal; /* Ø§Ø¬Ø§Ø²Ù‡ Ø¨Ø´Ú©Ù†Ù‡ */
            word-break: break-word; /* Ø§Ú¯Ù‡ Ø®ÛŒÙ„ÛŒ Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø¨Ø§Ø´Ù‡ Ú©Ù„Ù…Ù‡ Ø¨Ø´Ú©Ù†Ù‡ */
        }
        #header{
            justify-items: center;
            align-items: center;
            justify-items: center;
            text-align: center;
        }
        #titlelogo{
            width: 65px;
        }
        #connectionDuration{
            margin: 2px 5px 2px 20px;
        }
        .connectiontimer{
            background: linear-gradient(120deg,rgba(19, 32, 60, 1) 50%, rgba(56, 78, 156, 1) 100%);
            border: white 1px solid;
            border-radius: 12px;
            padding: 3px 10px 3px 10px;

        }
        /* About Modal & Panel */
        #aboutModal {
            display: none;
        }
        #aboutPanel {
            display: none;
        }

        /*splashscreen*/
        #splashScreen{
            position:fixed;
            inset:0;
            background:#0b1020;
            display:flex;
            flex-direction:column;
            align-items:center;
            justify-content:center;
            z-index:9999;
        }
        /* ---------- Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø¯Ø§ÛŒØ±Ù‡ Ø§ÛŒ Ù†Ø§Ø²Ú© Ø³ÙÛŒØ¯ ---------- */
        .loader-circle{
            width:48px;
            height:48px;
            margin-top:2rem;
            border:3px solid rgba(255,255,255,.2);
            border-top-color:#fff;
            border-radius:50%;
            animation:spin 2s linear infinite;
        }
        .loadinglogo{
            width:220px;
            height:220px;
            object-fit:contain;
        }
        #splashText{
            margin-top:1rem;
            color:#fff;
            font-size:1.1rem;
            text-align:center;
        }
        /*Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ù„ÙˆØ¯ÛŒÙ†Ú¯ Ø¯Ø§ÛŒØ±Ù‡ Ø§ÛŒ*/
        @keyframes spin{
            to{transform:rotate(360deg)}
        }
        /*Ù¾Ø§ÛŒØ§Ù† Ù‚Ø³Ù…Øª Ù„ÙˆØ¯ÛŒÙ†Ú¯ ÙˆØ±ÙˆØ¯*/

        /* ---------- Ø§Ø³ØªØ§ÛŒÙ„ Ú©Ø§Ø±Øª ØªØ³Øª Ø³Ø±Ø¹Øª Ø§ÛŒÙ†ØªØ±Ù†Øª ---------- */
        .bg-card{background: #001023;border:1px solid rgba(148, 163, 184, 0.4);border-radius:1rem;padding:1.5rem}
        .title-card{font-size:1.125rem;font-weight:700;color:#fff;margin-bottom:.5rem}
        .desc-card{font-size:.875rem;color:#94a3b8;margin-bottom:1rem}
        .btn-action{background:#3b82f6;color:#fff;padding:.5rem 1.25rem;border-radius:.5rem;font-weight:600;transition:.3s}
        .btn-action:hover{background:#2563eb}
        .res-row{color:#e2e8f0;font-size:.95rem;margin:.25rem 0}


        @media (max-width: 700px) {
            .config-name { max-width: 25ch; }
        }
        body { overflow-x: hidden; }
    </style>
</head>
<body class="min-h-screen text-white">
<!-- ØµÙØ­Ù‡ Ø§Ø³Ù¾Ù„Ø´ 2 Ø«Ø§Ù†ÛŒÙ‡ Ø§ÛŒ -->
<div id="splashScreen" >
    <img class="loadinglogo" src="applogo.png" alt="Ù„ÙˆÚ¯Ùˆ">
    <p id="splashText">
        ØªÙˆØ³Ø¹Ù‡ ÛŒØ§ÙØªÙ‡ ØªÙˆØ³Ø· Ù…Ù‡Ø¯ÛŒ Ø¢Ø´ÙˆØ±ÛŒ<br>developed by Mahdi ASHUORI
    </p>
    <div class="loader-circle"></div>
</div>
<!-- Header -->
<div class="hg p-6 shadow-2xl" id="header">
    <div class="flex items-center justify-center">
        <div class="flex items-center space-x-4 space-x-reverse">
            <div id="titlelogo" class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                <img src="v2malogo.png">
            </div>
            <div>
                <div class="tbx">
                    <h1 class="apt"><b>V2MA.apk</b></h1>
                </div>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">V2Ray Manager Pro</h1>
                <p class="text-sm text-slate-400">Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ù‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯<br>
                    ØªÙˆØ³Ø¹Ù‡ ÛŒØ§ÙØªÙ‡ ØªÙˆØ³Ø· Ù…Ù‡Ø¯ÛŒ Ø¢Ø´ÙˆØ±ÛŒ</p>
            </div>
        </div>

    </div>
</div>

<!-- Connection Panel -->
<div class="p-6">
    <div class="g rounded-2xl p-8 mb-8 shadow-2xl">

        <!-- ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„ (Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯Ù‡ Ø§Ø² Ù‡Ø¯Ø±) -->
        <div class="flex items-center justify-center gap-3 mb-4">
            <div class="si bg-slate-500" id="connectionStatus"></div>
            <span class="text-sm font-medium" id="statusText">Ø¢Ù…Ø§Ø¯Ù‡ Ø§ØªØµØ§Ù„</span>
            <div class="connectiontimer">
                <span class="text-sm text-slate-400 hidden" id="connectionDuration">â± Ù…Ø¯Øª Ø§ØªØµØ§Ù„: 00:00</span> <!-- <- Ø§Ù„Ù…Ø§Ù† ØªØ§ÛŒÙ…Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯ -->
            </div>
        </div>
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-xl font-bold text-slate-200">ÙˆØ¶Ø¹ÛŒØª Ø§ØªØµØ§Ù„</h2>
            <button id="connectBtn" class="nb bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-8 py-3 rounded-xl font-bold transition-all duration-300">
                Ø§ØªØµØ§Ù„ Ø³Ø±ÛŒØ¹
            </button>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <div class="text-center">
                <div class="sm w-20 h-20 rounded-full mx-auto mb-3 flex items-center justify-center">
                    <span class="text-white font-bold text-lg" id="pingValue">--</span>
                </div>
                <p class="text-sm text-slate-400 font-medium">Ù¾ÛŒÙ†Ú¯</p>
            </div>
            <div class="text-center">
                <div class="bg-gradient-to-br from-blue-500 to-blue-600 w-20 h-20 rounded-full mx-auto mb-3 flex items-center justify-center shadow-lg">
                    <span class="text-white font-bold text-sm" id="downloadSpeed">â†“ --</span>
                </div>
                <p class="text-sm text-slate-400 font-medium">Ø¯Ø§Ù†Ù„ÙˆØ¯</p>
            </div>
            <div class="text-center">
                <div class="bg-gradient-to-br from-purple-500 to-purple-600 w-20 h-20 rounded-full mx-auto mb-3 flex items-center justify-center shadow-lg">
                    <span class="text-white font-bold text-sm" id="uploadSpeed">â†‘ --</span>
                </div>
                <p class="text-sm text-slate-400 font-medium">Ø¢Ù¾Ù„ÙˆØ¯</p>
            </div>
            <div class="text-center">
                <div class="bg-gradient-to-br from-orange-500 to-orange-600 w-20 h-20 rounded-full mx-auto mb-3 flex items-center justify-center shadow-lg">
                    <span class="text-white font-bold text-sm" id="dataUsage">--</span>
                </div>
                <p class="text-sm text-slate-400 font-medium">Ù…ØµØ±Ù Ø¯Ø§Ø¯Ù‡</p>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="g rounded-2xl shadow-2xl mb-8">
        <div class="flex border-b border-slate-700">
            <button class="tab-btn ta flex-1 py-4 px-6 text-center font-bold rounded-tl-2xl transition-all duration-300" data-tab="configs">Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§</button>
            <button class="tab-btn flex-1 py-4 px-6 text-center font-bold text-slate-400 hover:text-white transition-all duration-300" data-tab="settings">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
            <button class="tab-btn flex-1 py-4 px-6 text-center font-bold text-slate-400 hover:text-white rounded-tr-2xl transition-all duration-300" data-tab="tools">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§</button>
        </div>

        <!-- Configs Tab -->
        <div id="configs" class="tab-content p-6">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-slate-200">Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ÛŒ Ù…Ù†</h3>

                <!-- Bulk menu button (mobile) -->
                <button id="bulkMenuBtn" class="bmb nb bg-gradient-to-r from-slate-600 to-slate-700 text-white px-4 py-2 rounded-xl font-bold text-sm">
                    â˜° Ø¹Ù…Ù„ÛŒØ§Øª
                </button>

                <!-- Top actions (desktop) -->
                <div class="tacts flex flex-wrap gap-3">
                    <button id="pingAllBtn" class="nb bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white px-4 py-2 rounded-xl font-bold text-sm transition-all duration-300 flex items-center space-x-2 space-x-reverse">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                        <span>ØªØ³Øª Ù¾ÛŒÙ†Ú¯ Ù‡Ù…Ù‡</span>
                    </button>
                    <button id="cleanupBtn" class="nb bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-4 py-2 rounded-xl font-bold text-sm transition-all duration-300">Ø­Ø°Ù ØºÛŒØ±ÙØ¹Ø§Ù„â€ŒÙ‡Ø§</button>
                    <button id="shareAllBtn" class="nb bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-xl font-bold text-sm transition-all duration-300">Ø§Ø´ØªØ±Ø§Ú© Ù‡Ù…Ù‡</button>
                    <button id="shareActiveBtn" class="nb bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white px-4 py-2 rounded-xl font-bold text-sm transition-all duration-300">Ø§Ø´ØªØ±Ø§Ú© ÙØ¹Ø§Ù„â€ŒÙ‡Ø§</button>
                    <button id="clipboardBtn" class="nb bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-4 py-2 rounded-xl font-bold text-sm transition-all duration-300">Ø§Ø² Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯</button>
                    <button id="selectModeBtn" class="nb bg-gradient-to-r from-slate-500 to-slate-600 hover:from-slate-600 hover:to-slate-700 text-white px-4 py-2 rounded-xl font-bold text-sm">Ø§Ù†ØªØ®Ø§Ø¨</button>
                    <button id="deleteAllBtn" class="nb bg-gradient-to-r from-red-700 to-red-800 hover:from-red-800 hover:to-red-900 text-white px-4 py-2 rounded-xl font-bold text-sm">Ø­Ø°Ù Ù‡Ù…Ù‡</button>
                    <button id="addConfigBtn" class="nb bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white px-4 py-2 rounded-xl font-bold text-sm">+ Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†ÙÛŒÚ¯</button>
                    <button id="createFolderBtn" class="nb bg-gradient-to-r from-slate-600 to-slate-700 text-white px-3 py-2 rounded-xl text-sm">+ Ù¾ÙˆØ´Ù‡ Ø¬Ø¯ÛŒØ¯</button>
                </div>
            </div>

            <!-- Folder bar -->
            <div id="folderBar" class="mb-4 flex flex-wrap items-center gap-2">
                <button id="allFolderChip" class="px-3 py-1 rounded-lg bg-slate-700 hover:bg-slate-600 text-sm">Ù‡Ù…Ù‡</button>
                <div id="folderChips" class="flex flex-wrap gap-2"></div>
            </div>

            <!-- Selection bar -->
            <div id="selectionBar" class="g rounded-xl p-3 mb-4">
                <div class="flex items-center justify-between">
                    <span id="selectionCount" class="text-sm text-slate-300">0 Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡</span>
                    <div class="flex gap-2">
                        <button id="moveToFolderBtn" class="nb bg-gradient-to-r from-blue-500 to-cyan-500 text-white px-3 py-1 rounded-lg text-sm">Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ù¾ÙˆØ´Ù‡</button>
                        <button id="shareSelectedBtn" class="nb bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-3 py-1 rounded-lg text-sm">Ø§Ø´ØªØ±Ø§Ú©</button>
                        <button id="pingSelectedBtn" class="nb bg-gradient-to-r from-yellow-500 to-orange-500 text-white px-3 py-1 rounded-lg text-sm">Ù¾ÛŒÙ†Ú¯</button>
                        <button id="deleteSelectedBtn" class="nb bg-gradient-to-r from-red-500 to-red-600 text-white px-3 py-1 rounded-lg text-sm">Ø­Ø°Ù</button>
                    </div>
                </div>
            </div>

            <div id="configsList" class="space-y-4"></div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content p-6 hidden">
            <div class="space-y-8">
                <div>
                    <h3 class="text-xl font-bold text-slate-200 mb-6">ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ</h3>
                    <div class="space-y-6">
                        <div class="flex items-center justify-between p-4 g rounded-xl">
                            <span class="text-slate-300 font-medium">Ø§ØªØµØ§Ù„ Ø®ÙˆØ¯Ú©Ø§Ø±</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="autoConnectToggle" class="sr-only peer">
                                <div class="w-14 h-7 bg-slate-600 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-gradient-to-r peer-checked:from-blue-500 peer-checked:to-purple-500"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between p-4 g rounded-xl">
                            <span class="text-slate-300 font-medium">Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" checked>
                                <div class="w-14 h-7 bg-slate-600 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-gradient-to-r peer-checked:from-blue-500 peer-checked:to-purple-500"></div>
                            </label>
                        </div>
                        <div class="p-4 g rounded-xl">
                            <label class="block text-slate-300 font-medium mb-3">Ù¾Ø±ÙˆØªÚ©Ù„ Ù¾ÛŒØ´â€ŒÙØ±Ø¶</label>
                            <select id="defaultProto" class="w-full p-4 bg-slate-700 border border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-white">
                                <option>VMess</option>
                                <option>VLESS</option>
                                <option>Trojan</option>
                                <option>Shadowsocks</option>
                            </select>
                        </div>
                        <div class="p-4 g rounded-xl">
                            <h4 class="font-bold mb-2">ÙˆØ±ÙˆØ¯ Ø³Ø±ÛŒØ¹</h4>
                            <div class="flex flex-wrap gap-2">
                                <button id="settingsImportClipboard" class="ib">Ø§Ø² Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯</button>
                                <button id="settingsExport" class="ib">Ø®Ø±ÙˆØ¬ÛŒ (JSON)</button>
                                <label class="ib cursor-pointer">
                                    ÙˆØ±ÙˆØ¯ÛŒ (JSON)
                                    <input type="file" id="settingsImportFile" accept="application/json" class="hidden">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-4 g rounded-xl mt-6">
                <h3 class="text-lg font-bold text-slate-200 mb-4 flex items-center gap-3">
                    <img alt="Telegram" class="w-8 h-8 rounded-full" src="telegramlogo.png">
                    <img alt="App Logo" class="w-8 h-8 rounded-full" src="v2malogo.png">
                    Ú©Ø§Ù†Ø§Ù„ ØªÙ„Ú¯Ø±Ø§Ù…
                </h3>
                <p class="text-slate-300 mb-4 text-sm">
                    ØªÙ…Ø§Ù…ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ùˆ Ø¢Ù…ÙˆØ²Ø´ Ù‡Ø§ Ùˆ Ø§Ø®Ø¨Ø§Ø± Ùˆ Ú©Ø§Ù†ÙÛŒÚ¯ Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø±Ùˆ Ø§Ø² Ú©Ø§Ù†Ø§Ù„ ØªÙ„Ú¯Ø±Ø§Ù… Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯
                </p>
                <a class="nb bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-xl font-bold text-sm transition-all duration-300 inline-block" href="https://t.me/+GUJjlbInWBxlMzIx" target="_blank">
                    ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„
                </a>
            </div>
            <!-- About Section Button -->
            <div class="p-4 g rounded-xl mt-6">
                <h3 class="text-lg font-bold text-slate-200 mb-4 flex items-center gap-3">
                    <img alt="About" class="w-8 h-8 rounded-full" src="aboutlogo.png"/> <!-- Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø¨Ø§ Ù„ÙˆÚ¯Ùˆ Ù…Ù†Ø§Ø³Ø¨ -->
                    <span>Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§</span>
                </h3>
                <p class="text-slate-300 mb-4 text-sm">
                    Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³ Ùˆ Ù‚ÙˆØ§Ù†ÛŒÙ† Ù…Ø±Ø¨ÙˆØ· Ø¨Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡
                </p>
                <button id="aboutBtn" class="nb bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-xl font-bold text-sm transition-all duration-300 inline-block">
                    Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ù…Ù‚Ø±Ø±Ø§Øª
                </button>
            </div>

            <!-- About Modal (for mobile) -->
            <div id="aboutModal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 backdrop-blur-sm">
                <div class="g rounded-2xl p-6 m-4 w-full max-w-lg shadow-2xl flex flex-col h-[80vh]">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-slate-200">Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ù…Ù‚Ø±Ø±Ø§Øª</h3>
                        <button id="closeAboutModalBtn" class="text-red-500 hover:text-red-400 text-2xl">âœ•</button>
                    </div>
                    <div id="aboutContentMobile" class="overflow-y-auto flex-grow text-slate-300 text-sm">
                        <!-- Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯ -->
                    </div>
                </div>
            </div>

            <!-- About Panel (for desktop) -->
            <div id="aboutPanel" class="hidden g rounded-xl p-6 mt-4">
                <h4 class="text-lg font-bold text-slate-200 mb-3">Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ù…Ù‚Ø±Ø±Ø§Øª</h4>
                <div id="aboutContentDesktop" class="text-slate-300 text-sm">
                    <!-- Ù‚ÙˆØ§Ù†ÛŒÙ† Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù†Ø¯ -->
                </div>
            </div>
        </div>

        <!-- Tools Tab -->
        <div id="tools" class="tab-content p-6 hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-gradient-to-br from-blue-600 to-blue-700 p-6 rounded-xl shadow-lg">
                    <h4 class="font-bold text-white text-lg mb-2">ØªØ³Øª Ø³Ø±Ø¹Øª</h4>
                    <p class="text-sm text-blue-100 mb-4">Ø¨Ø±Ø±Ø³ÛŒ Ø³Ø±Ø¹Øª Ø§ØªØµØ§Ù„ Ø´Ù…Ø§</p>
                    <button id="speedTestBtn" class="nb bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-6 py-3 rounded-xl font-bold text-sm transition-all duration-300 w-full">
                        Ø´Ø±ÙˆØ¹ ØªØ³Øª
                    </button>
                </div>

                <div class="bg-gradient-to-br from-green-600 to-green-700 p-6 rounded-xl shadow-lg">
                    <h4 class="font-bold text-white text-lg mb-2">Ù¾ÛŒÙ†Ú¯ ØªØ³Øª</h4>
                    <p class="text-sm text-green-100 mb-4">Ø¨Ø±Ø±Ø³ÛŒ ØªØ£Ø®ÛŒØ± Ø´Ø¨Ú©Ù‡ (Ù‡Ù…Ø²Ù…Ø§Ù†)</p>
                    <button id="pingTestToolBtn" class="nb bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-6 py-3 rounded-xl font-bold text-sm transition-all duration-300 w-full">
                        Ø´Ø±ÙˆØ¹ Ù¾ÛŒÙ†Ú¯
                    </button>
                </div>

                <div class="bg-gradient-to-br from-purple-600 to-purple-700 p-6 rounded-xl shadow-lg">
                    <h4 class="font-bold text-white text-lg mb-2">Ø§Ø³Ú©Ù† QR</h4>
                    <p class="text-sm text-purple-100 mb-4">Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ú©Ø§Ù†ÙÛŒÚ¯ Ø¨Ø§ QR Ú©Ø¯</p>
                    <div class="space-y-2">
                        <input id="qrFileInputTools" type="file" accept="image/*" class="w-full p-2 bg-slate-800 rounded text-sm" />
                        <button id="scanQrBtnTools" class="nb bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-6 py-3 rounded-xl font-bold text-sm transition-all duration-300 w-full">
                            Ø§Ø³Ú©Ù† Ú©Ø±Ø¯Ù† Ø¨Ø§ Ø¯ÙˆØ±Ø¨ÛŒÙ†
                        </button>
                    </div>
                </div>

                <div class="bg-gradient-to-br from-orange-600 to-orange-700 p-6 rounded-xl shadow-lg">
                    <h4 class="font-bold text-white text-lg mb-2">Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</h4>
                    <p class="text-sm text-orange-100 mb-4">Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ Ùˆ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§<br>
                        Ù…ÛŒ ØªÙˆØ§Ù†ÛŒØ¯ Ú©Ø§Ù†ÙÛŒÚ¯ Ù‡Ø§ÛŒ Ø¨Ø±ÙˆØ² Ø±Ø§ Ø§Ø² Ú©Ø§Ù†Ø§Ø§Ù„ ØªÙ„Ú¯Ø±Ø§Ù… Ø¯Ø±ÛŒØ§ÙØª Ú©Ù†ÛŒØ¯<br>
                        Ùˆ Ø§Ø² Ø§ÛŒÙ† Ù‚Ø³Ù…Øª ÙˆØ§Ø±Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ú©Ù†ÛŒØ¯</p>
                    <div class="grid grid-cols-2 gap-3">
                        <button id="backupBtn" class="nb bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-3 rounded-xl font-bold text-sm transition-all duration-300">Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ</button>
                        <button id="restoreBtn" class="nb bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-3 rounded-xl font-bold text-sm transition-all duration-300">Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ</button>
                        <input type="file" id="backupInput" accept="application/json" class="hidden" />
                    </div>
                </div>
                <!-- Ú©Ø§Ø±Øª ØªØ³Øª Ø³Ø±Ø¹Øª Ø§ÛŒÙ†ØªØ±Ù†Øª -->
                <div class="bg-card p-6 rounded-xl shadow">
                    <h4 class="title-card">ØªØ³Øª Ø³Ø±Ø¹Øª Ø§ÛŒÙ†ØªØ±Ù†Øª Ø´Ù…Ø§</h4>
                    <p class="desc-card">Ø§Ù†Ø¯Ø§Ø²Ù‡â€ŒÚ¯ÛŒØ±ÛŒ Ø¯Ø§Ù†Ù„ÙˆØ¯ØŒ Ø¢Ù¾Ù„ÙˆØ¯ Ùˆ Ù¾ÛŒÙ†Ú¯ Ø¨Ù‡ Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ø³Ø±ÙˆØ± Ø¨Ø¯ÙˆÙ† Ù†ÛŒØ§Ø² Ø¨Ù‡ Ú©Ø§Ù†Ú©Øª Ø´Ø¯Ù†.</p>
                    <button id="netSpeedTestBtn" class="btn-action">Ø´Ø±ÙˆØ¹ ØªØ³Øª Ø³Ø±Ø¹Øª</button>
                    <div id="netSpeedResult" class="mt-4 hidden">
                        <div class="res-row">Ø¯Ø§Ù†Ù„ÙˆØ¯: <span id="downMbps">--</span> Mbps</div>
                        <div class="res-row">Ø¢Ù¾Ù„ÙˆØ¯: <span id="upMbps">--</span> Mbps</div>
                        <div class="res-row">Ù¾ÛŒÙ†Ú¯: <span id="pingMs">--</span> ms</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Config Modal -->
<div id="addConfigModal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 backdrop-blur-sm">
    <div class="g rounded-2xl p-8 m-4 w-full max-w-md shadow-2xl">
        <h3 class="text-xl font-bold text-slate-200 mb-6">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†ÙÛŒÚ¯ Ø¬Ø¯ÛŒØ¯</h3>
        <div class="space-y-6">
            <div>
                <label class="block text-slate-300 font-medium mb-3">Ù„ÛŒÙ†Ú© Ú©Ø§Ù†ÙÛŒÚ¯</label>
                <textarea id="configUrl" class="w-full p-4 bg-slate-700 border border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent h-32 text-white placeholder-slate-400" placeholder="vmess://... ÛŒØ§ vless://... ÛŒØ§ trojan://... ÛŒØ§ ss://..."></textarea>
                <p class="text-xs text-slate-400 mt-2">Ù†Ø§Ù… Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø² Ù„ÛŒÙ†Ú© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÛŒâ€ŒØ´ÙˆØ¯</p>
            </div>
            <div class="flex space-x-4 space-x-reverse">
                <button id="saveConfigBtn" class="flex-1 nb bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white py-3 px-6 rounded-xl font-bold transition-all duration-300">
                    Ø°Ø®ÛŒØ±Ù‡
                </button>
                <button id="cancelConfigBtn" class="flex-1 bg-slate-600 hover:bg-slate-700 text-slate-300 py-3 px-6 rounded-xl font-bold transition-all duration-300">
                    Ù„ØºÙˆ
                </button>
            </div>
        </div>
    </div>
</div>

<!-- QR Modal -->
<div id="qrModal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50 backdrop-blur-sm">
    <div class="g rounded-2xl p-6 m-4 w-full max-w-lg shadow-2xl">
        <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-bold text-slate-100">Ø§Ø³Ú©Ù† QR Ú©Ø§Ù†ÙÛŒÚ¯</h3>
            <button id="closeQrBtn" class="text-slate-300 hover:text-white">Ø¨Ø³ØªÙ† âœ•</button>
        </div>
        <div id="qrRegion" class="rounded-xl overflow-hidden bg-slate-800" style="width:100%;"></div>
        <p class="text-xs text-slate-400 mt-3">Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„Ú©Ø±Ø¯ ØµØ­ÛŒØ­ØŒ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† Ùˆ Ø§Ø¬Ø±Ø§ÛŒ Ø±ÙˆÛŒ HTTPS Ø§Ø³Øª.</p>
    </div>
</div>
<!-- Toast container -->
<div class="fixed bottom-5 right-5 z-50 space-y-2" id="toastContainer"></div>
<script>
    /* ------------ Ø­Ø°Ù Ø§Ø³Ù¾Ù„Ø´ Ø¨Ø¹Ø¯ Ø§Ø² 2 Ø«Ø§Ù†ÛŒÙ‡ ------------ */
    document.addEventListener('DOMContentLoaded',()=>{
        const splash=document.getElementById('splashScreen');
        if(!splash) return;
        setTimeout(()=>{
            splash.style.opacity='0';
            splash.style.transition='opacity .4s ease';
            setTimeout(()=>splash.remove(),400);
        },2000);
    });
    // ====== State & Storage Keys ======
    let configs = [];
    let folders = [];
    let currentFolderId = null;
    let selectMode = false;
    let selectedIds = new Set();
    let isPingTesting = false;

    // connection state
    let isConnected = false;
    let currentConfig = null;

    let qrInstance = null;
    let openMenuEl = null;

    const LS_KEY = 'v2m.configs';
    const LS_FOLDERS = 'v2m.folders';
    const LS_VIEW = 'v2m.view';
    const LS_STATE = 'v2m.state';

    // ====== Init ======
    document.addEventListener('DOMContentLoaded', init);

    function init() {
        loadAll();
        renderAll();
        setupEventListeners();
        setupAboutSection();
        updateConnectionStatus();
        startSpeedSimulation();
        showToast('Ø±ÙˆÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ØŒ Ø§Ú©Ø´Ù†â€ŒÙ‡Ø§ Ø¯Ø§Ø®Ù„ Ù…Ù†ÙˆÛŒ Ù‡Ù…Ø¨Ø±Ú¯Ø±ÛŒ Ù‡Ø³ØªÙ†Ø¯ âœ¨', 'info');
    }

    // ====== Storage ======
    function loadAll() {
        try {
            const c = JSON.parse(localStorage.getItem(LS_KEY) || '[]'); configs = Array.isArray(c)?c:[];
            const f = JSON.parse(localStorage.getItem(LS_FOLDERS) || '[]'); folders = Array.isArray(f)?f:[];
            const v = JSON.parse(localStorage.getItem(LS_VIEW) || '{}'); currentFolderId = v.currentFolderId ?? null;
            const st = JSON.parse(localStorage.getItem(LS_STATE) || '{}');
            if (st && st.currentConfigId) currentConfig = configs.find(x=>x.id===st.currentConfigId) || null;
            isConnected = !!(st && st.isConnected && currentConfig);
        } catch(e) {}
    }
    function saveAll() {
        localStorage.setItem(LS_KEY, JSON.stringify(configs));
        localStorage.setItem(LS_FOLDERS, JSON.stringify(folders));
        localStorage.setItem(LS_VIEW, JSON.stringify({ currentFolderId }));
        localStorage.setItem(LS_STATE, JSON.stringify({ isConnected, currentConfigId: currentConfig? currentConfig.id : null }));
    }

    // ====== Tabs ======
    function setupTabs() {
        document.querySelectorAll('.tab-btn').forEach(btn=>{
            btn.addEventListener('click', ()=> switchTab(btn.dataset.tab));
        });
    }
    function switchTab(tab) {
        document.querySelectorAll('.tab-btn').forEach(b=>{
            b.classList.remove('ta'); b.classList.add('text-slate-400');
        });
        const btn = document.querySelector(`.tab-btn[data-tab="${tab}"]`);
        if (btn) { btn.classList.add('ta'); btn.classList.remove('text-slate-400'); }
        document.querySelectorAll('.tab-content').forEach(c=> c.classList.add('hidden'));
        const el = document.getElementById(tab); if (el) el.classList.remove('hidden');
        closeAnyMenu();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // ====== Toast ======
    function showToast(msg, type='info') {
        const c = document.getElementById('toastContainer');
        const el = document.createElement('div');
        el.className = (type==='success') ? 'bg-emerald-600 text-white px-4 py-2 rounded-md shadow-lg' : (type==='error') ? 'bg-red-600 text-white px-4 py-2 rounded-md shadow-lg' : 'bg-slate-700 text-white px-4 py-2 rounded-md shadow-lg';
        el.style.marginTop='8px';
        el.textContent = msg;
        c.appendChild(el);
        setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.remove(),300); }, 2400);
    }

    // ====== Utils ======
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, (m)=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[m]); }
    function getScopedConfigs() { return currentFolderId ? configs.filter(c=>c.folderId===currentFolderId) : configs.slice(); }
    function getSelectedOrScopeConfigs() { if (selectedIds.size>0) return configs.filter(c=>selectedIds.has(c.id)); return getScopedConfigs(); }

    // ====== Parse Config ======
    function parseConfigFromUrl(url) {
        try {
            if (!url) return {name:'Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…', type:'Unknown', host:'', port: undefined};
            if (url.startsWith('vmess://')) {
                const b64 = url.slice(8);
                let decoded=''; try{ decoded = atob(b64.replace(/_/g,'/').replace(/-/g,'+')); }catch(e){ decoded = b64; }
                try { const j = JSON.parse(decoded); return { name: j.ps || j.add || 'VMess', type:'VMess', host:j.add||'', port: j.port?parseInt(j.port):undefined }; } catch(e){ return {name:'VMess', type:'VMess', host:'', port:undefined}; }
            } else if (url.startsWith('vless://') || url.startsWith('trojan://')) {
                const m = url.match(/^[a-z]+:\/\/(?:[^@]+@)?([^:/?#]+)(?::([0-9]+))?/i);
                const nameMatch = url.match(/#(.+)$/);
                return { name: nameMatch ? decodeURIComponent(nameMatch[1]) : (url.startsWith('vless')? 'VLESS' : 'Trojan'), type: url.startsWith('vless')? 'VLESS' : 'Trojan', host: m?m[1]:'', port: m&&m[2]?parseInt(m[2]):undefined };
            } else if (url.startsWith('ss://')) {
                const nameMatch = url.match(/#(.+)$/);
                let name = nameMatch ? decodeURIComponent(nameMatch[1]) : 'Shadowsocks';
                const raw = url.slice(5).split('#')[0];
                if (raw.includes('@')) { const parts=raw.split('@'); const right=parts[1]; const hp=right.split(':'); return {name, type:'Shadowsocks', host:hp[0], port:parseInt(hp[1])}; }
                try { const dec = atob(raw); const m = dec.match(/@?([^:]+):([0-9]{2,5})/); if (m) return {name,type:'Shadowsocks', host:m[1], port:parseInt(m[2])}; } catch(e){}
                return {name, type:'Shadowsocks', host:'', port:undefined};
            }
            return {name:'Ú©Ø§Ù†ÙÛŒÚ¯', type:'Unknown', host:'', port:undefined};
        } catch(e) { return {name:'Ú©Ø§Ù†ÙÛŒÚ¯', type:'Unknown', host:'', port:undefined}; }
    }

    function addConfigFromUrl(url, folderId=null) {
        if (!url) return false;
        if (!/^(vmess|vless|trojan|ss):\/\//.test(url)) return false;
        if (configs.some(c=>c.url===url)) return false;
        const p = parseConfigFromUrl(url);
        const cfg = {
            id: Date.now()+Math.random(), url,
            name:p.name, type:p.type, host:p.host||'', port:p.port,
            folderId: folderId||null, ping: undefined, status:'disconnected',
            pinned:false, pastPings:[]
        };
        configs.push(cfg);
        saveAll(); renderAll();
        return true;
    }

    // ====== Sorting & Ping color ======
    function sortConfigsByPing(list=configs) {
        list.sort((a,b)=> {
            const apin = a.pinned?0:1, bpin = b.pinned?0:1;
            if (apin!==bpin) return apin-bpin;
            const ap = (a.ping===undefined || a.ping==='timeout')?Infinity:a.ping;
            const bp = (b.ping===undefined || b.ping==='timeout')?Infinity:b.ping;
            return ap - bp;
        });
    }
    function getPingColorClass(ping) {
        if (!ping || ping==='timeout') return 'p-timeout';
        const v = Number(ping);
        if (isNaN(v)) return 'p-timeout';
        if (v < 100) return 'p-ex';
        if (v < 200) return 'p-good';
        return 'p-poor';
    }

    // ====== Render Folders ======
    function renderFolderBar() {
        const chips = document.getElementById('folderChips'); chips.innerHTML='';
        const allBtn = document.getElementById('allFolderChip');
        if (allBtn) {
            allBtn.classList.toggle('ta', currentFolderId===null);
            allBtn.onclick = ()=>{ currentFolderId=null; selectedIds.clear(); toggleSelectMode(false); saveAll(); renderAll(); showToast('Ù†Ù…Ø§ÛŒØ´ Ù‡Ù…Ù‡'); };
        }
        folders.forEach(f=>{
            const el = document.createElement('div');
            el.className = currentFolderId===f.id ? 'px-3 py-1 rounded bg-emerald-600 font-bold flex items-center gap-2' : 'px-3 py-1 rounded bg-slate-700 hover:bg-slate-600 flex items-center gap-2';
            el.innerHTML = `<span>ğŸ“‚ ${escapeHtml(f.name)}</span><button data-fid="${f.id}" title="Ø­Ø°Ù Ù¾ÙˆØ´Ù‡" class="text-red-400">ğŸ—‘</button>`;
            el.addEventListener('click',(e)=>{ if (e.target.dataset && e.target.dataset.fid) return; currentFolderId = f.id; selectedIds.clear(); toggleSelectMode(false); saveAll(); renderAll(); showToast('Ø¯Ø§Ø®Ù„ Ù¾ÙˆØ´Ù‡: '+f.name,'success'); });
            chips.appendChild(el);
        });
        chips.querySelectorAll('button[data-fid]').forEach(btn=>{
            btn.addEventListener('click',(e)=>{
                e.stopPropagation();
                const fid=parseFloat(e.target.dataset.fid);
                const folder = folders.find(ff=>ff.id===fid); if(!folder) return;
                const count=configs.filter(c=>c.folderId===folder.id).length;
                if(!confirm(`Ø­Ø°Ù Ù¾ÙˆØ´Ù‡ "${folder.name}" Ùˆ ${count} Ú©Ø§Ù†ÙÛŒÚ¯ Ø¯Ø§Ø®Ù„ Ø¢Ù†ØŸ`)) return;
                const rm=new Set(configs.filter(c=>c.folderId===folder.id).map(c=>c.id));
                configs = configs.filter(c=>!rm.has(c.id));
                if (currentConfig && rm.has(currentConfig.id)) { currentConfig=null; isConnected=false; updateConnectionStatus(); }
                folders = folders.filter(ff=>ff.id!==folder.id);
                if(currentFolderId===folder.id) currentFolderId=null;
                saveAll(); renderAll(); showToast('Ù¾ÙˆØ´Ù‡ Ø­Ø°Ù Ø´Ø¯','success');
            });
        });
    }

    // ====== Render Configs ======
    function renderConfigs() {
        const list = document.getElementById('configsList'); list.innerHTML='';
        const scope = getScopedConfigs();
        sortConfigsByPing(scope);

        scope.forEach(cfg=>{
            const card = document.createElement('div'); card.className='cc p-6 rounded-xl flex items-center justify-between';
            // Left section
            const left = document.createElement('div'); left.className='flex items-center gap-3';
            if (selectMode) {
                const cb=document.createElement('input'); cb.type='checkbox'; cb.checked = selectedIds.has(cfg.id);
                cb.addEventListener('change', ()=>{ if(cb.checked) selectedIds.add(cfg.id); else selectedIds.delete(cfg.id); updateSelectionBar(); });
                left.appendChild(cb);
            }
            const dot = document.createElement('div'); dot.className='w-4 h-4 rounded-full'; dot.style.background = (cfg.status==='connected')? '#34d399' : '#64748b'; left.appendChild(dot);
            const meta = document.createElement('div');
            let displayName = String(cfg.name || 'Ø¨Ø¯ÙˆÙ† Ù†Ø§Ù…');
            if (window.innerWidth > 700) {
                if (displayName.length > 70) displayName = displayName.slice(0,70) + '...';
            } else {
                if (displayName.length > 25) displayName = displayName.slice(0,25) + '...';
            }
            meta.innerHTML = `
          <div class="font-bold text-white config-name">${escapeHtml(displayName)}</div>
          <div class="text-sm text-slate-400">${escapeHtml(cfg.location||'ğŸŒ')} â€¢ ${escapeHtml(cfg.type||'')}</div>
          <div id="ping-${cfg.id}" class="text-sm font-bold mt-1 ${cfg.ping?getPingColorClass(cfg.ping):'text-slate-400'}">${cfg.ping ? (cfg.ping==='timeout'?'ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª':cfg.ping+'ms') : '--'}</div>
        `;
            left.appendChild(meta);

            // Actions (desktop)
            const actions = document.createElement('div'); actions.className='ca';
            actions.innerHTML = `
          <button class="px-3 py-1 rounded bg-slate-700" data-act="copy">Ú©Ù¾ÛŒ</button>
          <button class="px-3 py-1 roundÙed" data-act="pin">${cfg.pinned?'â­':'â˜†'}</button>
          <button class="px-3 py-1 rounded bg-yellow-500 text-black" data-act="ping">Ù¾ÛŒÙ†Ú¯</button>
          <button class="px-3 py-1 rounded bg-emerald-600" data-act="share">Ø§Ø´ØªØ±Ø§Ú©</button>
          <button class="px-3 py-1 rounded bg-blue-600" data-act="connect">${cfg.status==='connected'?'Ù‚Ø·Ø¹':'Ø§ØªØµØ§Ù„'}</button>
          <button class="px-3 py-1 rounded bg-slate-600" data-act="move">Ø§Ù†ØªÙ‚Ø§Ù„</button>
          <button class="px-3 py-1 rounded bg-red-600" data-act="delete">Ø­Ø°Ù</button>
        `;

            // Hamburger (mobile)
            const burger = document.createElement('button'); burger.className='cmb ib'; burger.textContent='â˜°';
            burger.addEventListener('click', (e)=> { e.stopPropagation(); openCardMenu(cfg, burger); });

            // Bind desktop action handlers
            actions.querySelectorAll('button').forEach(b=>{
                b.addEventListener('click',(e)=>{
                    e.stopPropagation();
                    const act = b.dataset.act;
                    handleCardAction(act, cfg);
                });
            });

            card.appendChild(left);
            card.appendChild(actions);
            card.appendChild(burger);
            list.appendChild(card);
        });

        updateSelectionBar();
    }

    function handleCardAction(act, cfg) {
        closeAnyMenu();
        if (act==='copy') {
            navigator.clipboard.writeText(cfg.url||'').then(()=>showToast('Ú©Ù¾ÛŒ Ø´Ø¯','success'));
        } else if (act==='pin') {
            cfg.pinned = !cfg.pinned; saveAll(); renderConfigs();
        } else if (act==='ping') {
            testSinglePing(cfg.id);
        } else if (act==='share') {
            shareConfig(cfg.id);
        } else if (act==='move') {
            promptMoveSingleToFolder(cfg.id);
        } else if (act==='delete') {
            deleteConfig(cfg.id);
        } else if (act==='connect') {
            toggleConnectionTo(cfg.id);
        }
    }

    // ====== Menus ======
    function closeAnyMenu() {
        if (openMenuEl) { openMenuEl.remove(); openMenuEl=null; }
    }
    document.addEventListener('click', (e)=> {
        if (openMenuEl && !openMenuEl.contains(e.target)) closeAnyMenu();
    });

    function openCardMenu(cfg, anchorEl) {
        closeAnyMenu();
        const m = document.createElement('div');
        m.className='mp';
        m.innerHTML = `
        <div class="mi" data-act="ping">ğŸ“ Ù¾ÛŒÙ†Ú¯</div>
        <div class="mi" data-act="copy">ğŸ“‹ Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©</div>
        <div class="mi" data-act="share">ğŸ”— Ø§Ø´ØªØ±Ø§Ú©</div>
        <div class="mi" data-act="connect">${cfg.status==='connected'?'â›” Ù‚Ø·Ø¹':'âœ… Ø§ØªØµØ§Ù„'}</div>
        <div class="mi" data-act="move">ğŸ“‚ Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ù¾ÙˆØ´Ù‡</div>
        <div class="mi" data-act="pin">${cfg.pinned?'â­ Ø­Ø°Ù Ù¾ÛŒÙ†':'â­ Ù¾ÛŒÙ†'}</div>
        <div class="mi" data-act="delete">ğŸ—‘ Ø­Ø°Ù</div>
      `;
        document.body.appendChild(m);
        positionMenu(m, anchorEl);
        openMenuEl = m;

        m.querySelectorAll('.mi').forEach(item=>{
            item.addEventListener('click', ()=>{
                const act = item.dataset.act;
                handleCardAction(act, cfg);
            });
        });
    }

    function openBulkMenu(anchorEl) {
        closeAnyMenu();
        const m = document.createElement('div');
        m.className='mp';
        m.innerHTML = `
        <div class="mi" data-act="pingAll">ğŸ“ Ù¾ÛŒÙ†Ú¯ Ù‡Ù…Ù‡</div>
        <div class="mi" data-act="cleanup">ğŸ§¹ Ø­Ø°Ù ØºÛŒØ±ÙØ¹Ø§Ù„â€ŒÙ‡Ø§</div>
        <div class="mi" data-act="shareAll">ğŸ”— Ø§Ø´ØªØ±Ø§Ú© Ù‡Ù…Ù‡</div>
        <div class="mi" data-act="shareActive">âœ… Ø§Ø´ØªØ±Ø§Ú© ÙØ¹Ø§Ù„â€ŒÙ‡Ø§</div>
        <div class="mi" data-act="importClipboard">ğŸ“‹ ÙˆØ§Ø±Ø¯Ú©Ø±Ø¯Ù† Ø§Ø² Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯</div>
        <div class="mi" data-act="selectMode">ğŸ–± Ø­Ø§Ù„Øª Ø§Ù†ØªØ®Ø§Ø¨</div>
        <div class="mi" data-act="deleteAll">ğŸ—‘ Ø­Ø°Ù Ù‡Ù…Ù‡</div>
        <div class="mi" data-act="addConfig">â• Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ù†ÙÛŒÚ¯</div>
        <div class="mi" data-act="newFolder">ğŸ“ Ù¾ÙˆØ´Ù‡ Ø¬Ø¯ÛŒØ¯</div>
      `;
        document.body.appendChild(m);
        positionMenu(m, anchorEl);
        openMenuEl = m;

        m.querySelectorAll('.mi').forEach(item=>{
            item.addEventListener('click', ()=>{
                const act = item.dataset.act;
                closeAnyMenu();
                if (act==='pingAll') testAllPings();
                else if (act==='cleanup') cleanupInactiveServers();
                else if (act==='shareAll') shareAllConfigs();
                else if (act==='shareActive') shareActiveConfigs();
                else if (act==='importClipboard') importFromClipboard();
                else if (act==='selectMode') toggleSelectMode(true);
                else if (act==='deleteAll') deleteAllInScope();
                else if (act==='addConfig') toggleModal('addConfigModal', true);
                else if (act==='newFolder') createFolder();
            });
        });
    }

    function positionMenu(menuEl, anchorEl) {
        const r = anchorEl.getBoundingClientRect();
        const top = r.bottom + window.scrollY + 6;
        const left = r.left + window.scrollX - (menuEl.offsetWidth - r.width);
        menuEl.style.top = top + 'px';
        menuEl.style.left = Math.max(8, left) + 'px';
    }

    // ====== Selection Bar ======
    function updateSelectionBar() {
        const bar = document.getElementById('selectionBar');
        const cnt = document.getElementById('selectionCount');
        const btn = document.getElementById('selectModeBtn');
        if (selectMode) { bar.style.display='flex'; cnt.innerText = selectedIds.size + ' Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯Ù‡'; if (btn) btn.innerText='Ù¾Ø§ÛŒØ§Ù† Ø§Ù†ØªØ®Ø§Ø¨'; }
        else { bar.style.display='none'; selectedIds.clear(); if (btn) btn.innerText='Ø§Ù†ØªØ®Ø§Ø¨'; }
    }
    function toggleSelectMode(force) {
        selectMode = (force !== undefined) ? force : !selectMode;
        if (!selectMode) selectedIds.clear();
        renderConfigs(); updateSelectionBar();
    }

    // ====== Core Actions ======
    function deleteConfig(id) {
        if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ú©Ø§Ù†ÙÛŒÚ¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) return;
        const wasCurrent = currentConfig && currentConfig.id===id;
        configs = configs.filter(c=>c.id!==id);
        if (wasCurrent) { currentConfig=null; isConnected=false; updateConnectionStatus(); }
        selectedIds.delete(id);
        saveAll(); renderAll(); showToast('Ú©Ø§Ù†ÙÛŒÚ¯ Ø­Ø°Ù Ø´Ø¯','success');
    }
    function deleteAllInScope() {
        const scope = getScopedConfigs();
        if (scope.length===0) return showToast('Ú†ÛŒØ²ÛŒ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù†ÛŒØ³Øª','info');
        if (!confirm(`Ø­Ø°Ù ${scope.length} Ú©Ø§Ù†ÙÛŒÚ¯ØŸ`)) return;
        const rmIds = new Set(scope.map(c=>c.id));
        const wasCurrent = currentConfig && rmIds.has(currentConfig.id);
        configs = configs.filter(c=>!rmIds.has(c.id));
        if (wasCurrent) { currentConfig=null; isConnected=false; updateConnectionStatus(); }
        saveAll(); renderAll(); showToast('Ø­Ø°Ù Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯','success');
    }

    function shareConfig(id) {
        const cfg = configs.find(c=>c.id===id); if (!cfg || !cfg.url) return showToast('Ú©Ø§Ù†ÙÛŒÚ¯ ÛŒØ§ÙØª Ù†Ø´Ø¯','error');
        navigator.clipboard.writeText(cfg.url).then(()=>{ showToast('Ú©Ù¾ÛŒ Ø´Ø¯','success'); if (navigator.share) navigator.share({ title: cfg.name, text: cfg.url }).catch(()=>{}); });
    }
    function shareAllConfigs() {
        const scope = getSelectedOrScopeConfigs();
        const urls = scope.filter(c=>c.url).map(c=>c.url);
        if (!urls.length) return showToast('Ù‡ÛŒÚ† URLÛŒ Ø¯Ø± Ø§ÛŒÙ† Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù†ÛŒØ³Øª','info');
        const text = urls.join('\n');
        navigator.clipboard.writeText(text).then(()=>{ showToast(`${urls.length} Ú©Ø§Ù†ÙÛŒÚ¯ Ú©Ù¾ÛŒ Ø´Ø¯`,'success'); if (navigator.share) navigator.share({ title:'Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§', text }).catch(()=>{}); });
    }
    function shareActiveConfigs() {
        const scope = getSelectedOrScopeConfigs().filter(c=>c.ping!=='timeout' && c.url);
        if (!scope.length) return showToast('Ù‡ÛŒÚ† Ú©Ø§Ù†ÙÛŒÚ¯ ÙØ¹Ø§Ù„ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª','info');
        const text = scope.map(c=>c.url).join('\n');
        navigator.clipboard.writeText(text).then(()=>{ showToast(`${scope.length} Ú©Ø§Ù†ÙÛŒÚ¯ ÙØ¹Ø§Ù„ Ú©Ù¾ÛŒ Ø´Ø¯`,'success'); if (navigator.share) navigator.share({ title:'Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„', text }).catch(()=>{}); });
    }

    function moveSelectedToFolder() {
        if (selectedIds.size===0) return showToast('Ù‡ÛŒÚ†â€ŒÚ†ÛŒØ²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡','info');
        if (folders.length===0) return showToast('Ù¾ÙˆØ´Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯','info');
        const names = folders.map((f,i)=>`${i+1}) ${f.name}`).join('\n');
        const ans = prompt('Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ú©Ø¯Ø§Ù… Ù¾ÙˆØ´Ù‡ØŸ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n'+names);
        const idx = parseInt(ans,10)-1;
        if (isNaN(idx) || idx<0 || idx>=folders.length) return showToast('Ø´Ù…Ø§Ø±Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±','error');
        const fid = folders[idx].id;
        configs.forEach(c=>{ if (selectedIds.has(c.id)) c.folderId = fid; });
        selectedIds.clear(); toggleSelectMode(false); saveAll(); renderAll(); showToast('Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯','success');
    }
    function promptMoveSingleToFolder(configId) {
        if (folders.length===0) return showToast('Ù¾ÙˆØ´Ù‡â€ŒØ§ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯','info');
        const names = folders.map((f,i)=>`${i+1}) ${f.name}`).join('\n');
        const ans = prompt('Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ú©Ø¯Ø§Ù… Ù¾ÙˆØ´Ù‡ØŸ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:\n'+names);
        const idx = parseInt(ans,10)-1;
        if (isNaN(idx) || idx<0 || idx>=folders.length) return showToast('Ø´Ù…Ø§Ø±Ù‡ Ù†Ø§Ù…Ø¹ØªØ¨Ø±','error');
        const fid = folders[idx].id;
        const cfg = configs.find(c=>c.id===configId); if (!cfg) return;
        cfg.folderId = fid; saveAll(); renderAll(); showToast('Ù…Ù†ØªÙ‚Ù„ Ø´Ø¯','success');
    }
    function deleteSelected() {
        if (selectedIds.size===0) return showToast('Ù‡ÛŒÚ†â€ŒÚ†ÛŒØ²ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡','info');
        if (!confirm(`Ø­Ø°Ù ${selectedIds.size} Ù…ÙˆØ±Ø¯ØŸ`)) return;
        const rm = new Set(selectedIds);
        const wasCurrent = currentConfig && rm.has(currentConfig.id);
        configs = configs.filter(c=>!rm.has(c.id));
        if (wasCurrent) { currentConfig=null; isConnected=false; updateConnectionStatus(); }
        selectedIds.clear(); toggleSelectMode(false); saveAll(); renderAll(); showToast('Ù…ÙˆØ§Ø±Ø¯ Ø­Ø°Ù Ø´Ø¯Ù†Ø¯','success');
    }
    function createFolder() {
        const name = prompt('Ù†Ø§Ù… Ù¾ÙˆØ´Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:'); if (!name) return;
        folders.push({ id: Date.now()+Math.random(), name: name.trim() }); saveAll(); renderFolderBar(); showToast('Ù¾ÙˆØ´Ù‡ Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯','success');
    }

    // ====== Ping (simulated) ======
    function testSinglePing(id) {
        const cfg = configs.find(c=>c.id===id); if(!cfg) return;
        const el = document.getElementById('ping-'+id); if (el) { el.textContent='ØªØ³Øª...'; el.classList.add('p-testing'); }
        setTimeout(()=>{
            if (Math.random()<0.18) cfg.ping='timeout';
            else { cfg.ping = Math.floor(Math.random()*330)+20; cfg.pastPings = (cfg.pastPings||[]).slice(-4); cfg.pastPings.push(cfg.ping); }
            if (el) {
                el.className = `text-sm font-bold mt-1 ${cfg.ping?getPingColorClass(cfg.ping):'text-slate-400'}`;
                el.textContent = cfg.ping==='timeout' ? 'ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª' : `${cfg.ping}ms`;
                el.classList.remove('p-testing');
            }
            saveAll(); renderConfigs();
        }, 800+Math.random()*1200);
    }
    function testAllPings(listArg) {
        if (isPingTesting) return;
        const list = listArg || getSelectedOrScopeConfigs();
        if (!list || list.length===0) return showToast('Ù‡ÛŒÚ† Ú©Ø§Ù†ÙÛŒÚ¯ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÙ†Ú¯ Ù†ÛŒØ³Øª','info');
        isPingTesting = true;
        const btn = document.getElementById('pingAllBtn'); if (btn) { btn.disabled=true; btn.classList.add('opacity-80'); }
        list.forEach(cfg=>{
            const el = document.getElementById('ping-'+cfg.id);
            if (el) { el.textContent='ØªØ³Øª...'; el.classList.add('p-testing'); }
        });
        const tasks = list.map(cfg=> new Promise(res=>{
            setTimeout(()=>{ if (Math.random()<0.18) cfg.ping='timeout'; else { cfg.ping=Math.floor(Math.random()*330)+20; cfg.pastPings=(cfg.pastPings||[]).slice(-4); cfg.pastPings.push(cfg.ping);} const el=document.getElementById('ping-'+cfg.id); if(el){ el.className=`text-sm font-bold mt-1 ${cfg.ping?getPingColorClass(cfg.ping):'text-slate-400'}`; el.textContent= cfg.ping==='timeout'?'ØªØ§ÛŒÙ…â€ŒØ§ÙˆØª':`${cfg.ping}ms`; el.classList.remove('p-testing'); } res(); }, 700+Math.random()*900);
        }));
        Promise.all(tasks).then(()=>{ isPingTesting=false; if(btn){ btn.disabled=false; btn.classList.remove('opacity-80'); } saveAll(); renderConfigs(); showToast('Ù¾ÛŒÙ†Ú¯â€ŒÙ‡Ø§ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯','success'); });
    }

    // ====== Cleanup inactive ======
    function cleanupInactiveServers() {
        const scope = getSelectedOrScopeConfigs();
        const timeouts = scope.filter(c=>c.ping==='timeout');
        if (timeouts.length===0) return showToast('Ù‡ÛŒÚ† Ø³Ø±ÙˆØ± ØºÛŒØ±ÙØ¹Ø§Ù„ÛŒ Ù†ÛŒØ³Øª','info');
        if (!confirm(`Ø­Ø°Ù ${timeouts.length} Ø³Ø±ÙˆØ± ØºÛŒØ±ÙØ¹Ø§Ù„ØŸ`)) return;
        const rm = new Set(timeouts.map(c=>c.id));
        const wasCurrent = currentConfig && rm.has(currentConfig.id);
        configs = configs.filter(c=>!rm.has(c.id));
        if (wasCurrent) { currentConfig=null; isConnected=false; updateConnectionStatus(); }
        saveAll(); renderAll(); showToast('Ø³Ø±ÙˆØ±Ù‡Ø§ÛŒ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø­Ø°Ù Ø´Ø¯Ù†Ø¯','success');
    }

    // ====== Clipboard Import / Backup ======
    async function importFromClipboard() {
        try {
            const text = await navigator.clipboard.readText();
            const lines = text.split('\n').map(l=>l.trim()).filter(Boolean);
            let added=0; lines.forEach(line=> { if (/^(vmess|vless|trojan|ss):\/\//.test(line)) if (addConfigFromUrl(line, currentFolderId)) added++; });
            if (added) showToast(`${added} Ú©Ø§Ù†ÙÛŒÚ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯`,'success'); else showToast('Ú†ÛŒØ²ÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯','info');
        } catch(e) { showToast('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ú©Ù„ÛŒÙ¾â€ŒØ¨ÙˆØ±Ø¯ Ù…Ù…Ú©Ù† Ù†ÛŒØ³Øª','error'); }
    }
    function exportBackup() {
        const data = JSON.stringify({ configs, folders }, null, 2);
        const blob = new Blob([data], { type:'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href=url; a.download='v2ray-backup.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); showToast('Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯','success');
    }
    function importBackupFromFile(files) {
        if (!files || !files[0]) return;
        const reader = new FileReader();
        reader.onload = e => {
            try {
                const parsed = JSON.parse(e.target.result);
                let incomingConfigs=[], incomingFolders=[];
                if (Array.isArray(parsed)) incomingConfigs = parsed; else { incomingConfigs = parsed.configs||[]; incomingFolders = parsed.folders||[]; }
                const existing = new Set(configs.map(c=>c.url)); let added=0;
                incomingConfigs.forEach(c=>{ if (c.url && !existing.has(c.url)) { configs.push({ id: Date.now()+Math.random(), name:c.name||'Ú©Ø§Ù†ÙÛŒÚ¯', type:c.type||'Unknown', url:c.url, folderId:c.folderId||null, ping:c.ping, status:'disconnected', pinned:!!c.pinned }); added++; } });
                incomingFolders.forEach(ff=>{ if (!folders.some(x=>x.name===ff.name)) folders.push({ id: Date.now()+Math.random(), name:ff.name }); });
                saveAll(); renderAll(); showToast('Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯ ('+added+' Ø¬Ø¯ÛŒØ¯)','success');
            } catch(e){ showToast('ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø±','error'); }
        };
        reader.readAsText(files[0]);
    }

    // ====== QR ======
    async function handleQrFile(file) {
        if (!file) return showToast('ÙØ§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª','error');
        try {
            if (window.Html5Qrcode && typeof window.Html5Qrcode.scanFileV2 === 'function') {
                const res = await Html5Qrcode.scanFileV2(file, {});
                if (Array.isArray(res) && res.length) { res.forEach(r=>processQrDecoded(r.decodedText||r)); return; }
                else if (typeof res === 'string') { processQrDecoded(res); return; }
            }
        } catch(e){ console.warn('scanFileV2 failed', e); }
        // fallback with jsQR
        const img = new Image();
        img.onload = ()=> {
            try {
                const canvas = document.createElement('canvas'); canvas.width = img.width; canvas.height = img.height;
                const ctx = canvas.getContext('2d'); ctx.drawImage(img,0,0);
                const imageData = ctx.getImageData(0,0,canvas.width,canvas.height);
                const code = jsQR(imageData.data, canvas.width, canvas.height);
                if (code && code.data) { processQrDecoded(code.data); } else { showToast('QR Ø¯Ø± ØªØµÙˆÛŒØ± ÛŒØ§ÙØª Ù†Ø´Ø¯','info'); }
            } catch(e){ showToast('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±','error'); }
        };
        img.onerror = ()=> showToast('Ù‚Ø§Ø¨Ù„ Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† ØªØµÙˆÛŒØ± Ù†ÛŒØ³Øª','error');
        const reader = new FileReader(); reader.onload = ev => img.src = ev.target.result; reader.readAsDataURL(file);
    }
    function processQrDecoded(text) {
        if (!text || !/^(vmess|vless|trojan|ss):\/\//.test(text)) return showToast('QR Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª','error');
        if (addConfigFromUrl(text, currentFolderId)) showToast('Ú©Ø§Ù†ÙÛŒÚ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯','success'); else showToast('Ø§ÛŒÙ† Ú©Ø§Ù†ÙÛŒÚ¯ Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯','info');
    }
    async function startQrScan(regionId='qrRegion') {
        toggleModal('qrModal', true);
        try {
            await new Promise(res=>{ if (window.Html5Qrcode) return res(); const t=setInterval(()=>{ if (window.Html5Qrcode) { clearInterval(t); res(); } }, 100); });
            if (qrInstance) { try{ await qrInstance.stop(); }catch{} qrInstance=null; }
            qrInstance = new Html5Qrcode(regionId, { verbose:false });
            const config = { fps:10, qrbox:250 };
            const constraints = { facingMode:'environment' };
            await qrInstance.start(constraints, config, decodedText=>{ processQrDecoded(decodedText); stopQrScan(); });
        } catch(e){ showToast('Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯ÙˆØ±Ø¨ÛŒÙ† ÛŒØ§ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ QR Ø®Ø·Ø§ Ø¯Ø§Ø±Ø¯','error'); }
    }
    async function stopQrScan() { try{ if (qrInstance) { await qrInstance.stop(); await qrInstance.clear(); } }catch(e){} qrInstance=null; toggleModal('qrModal', false); }

    // ====== Modal ======
    function toggleModal(id, open) { const el=document.getElementById(id); if (!el) return; if (open) { el.classList.remove('hidden'); el.style.display='flex'; } else { el.classList.add('hidden'); el.style.display='none'; } }

    // ====== Connection ======
    function updateConnectionStatus() {
        const statusIndicator = document.getElementById('connectionStatus');
        const statusText = document.getElementById('statusText');
        const connectBtn = document.getElementById('connectBtn');
        if (isConnected && currentConfig) {
            statusIndicator.className = 'si bg-green-400';
            statusText.textContent = `Ù…ØªØµÙ„ Ø¨Ù‡ ${currentConfig.name}`;
            connectBtn.textContent = 'Ù‚Ø·Ø¹ Ø§ØªØµØ§Ù„';
            connectBtn.className = 'nb bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-8 py-3 rounded-xl font-bold transition-all';
        } else {
            statusIndicator.className = 'si bg-slate-500';
            statusText.textContent = 'Ø¢Ù…Ø§Ø¯Ù‡ Ø§ØªØµØ§Ù„';
            connectBtn.textContent = 'Ø§ØªØµØ§Ù„ Ø³Ø±ÛŒØ¹';
            connectBtn.className = 'nb bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-8 py-3 rounded-xl font-bold transition-all';
        }
    }
    function getBestConfigInScope() {
        const scope = getScopedConfigs().filter(c=>c.ping && c.ping!=='timeout');
        if (scope.length===0) return getScopedConfigs()[0];
        sortConfigsByPing(scope);
        return scope[0];
    }
    function toggleConnectionTo(configId) {
        const cfg = configs.find(c=>c.id===configId);
        if (!cfg) return;
        configs.forEach(c=>c.status='disconnected');
        if (!isConnected || (currentConfig?.id !== configId)) {
            cfg.status='connected'; currentConfig=cfg; isConnected=true;
        } else {
            currentConfig=null; isConnected=false;
        }
        saveAll(); renderConfigs(); updateConnectionStatus();
    }
    function quickConnect() {
        if (isConnected && currentConfig) { toggleConnectionTo(currentConfig.id); return; }
        const best = getBestConfigInScope();
        if (!best) return showToast('Ø§Ø¨ØªØ¯Ø§ Ú©Ø§Ù†ÙÛŒÚ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯','info');
        toggleConnectionTo(best.id);
    }
    function startSpeedSimulation() {
        setInterval(() => {
            if (isConnected) {
                const ping = Math.floor(Math.random() * 50) + 20;
                const download = Math.floor(Math.random() * 80) + 20;
                const upload = Math.floor(Math.random() * 40) + 10;
                const data = (Math.random() * 5 + 1).toFixed(1);
                document.getElementById('pingValue').textContent = ping + 'ms';
                document.getElementById('downloadSpeed').textContent = `â†“ ${download}MB/s`;
                document.getElementById('uploadSpeed').textContent = `â†‘ ${upload}MB/s`;
                document.getElementById('dataUsage').textContent = data + 'GB';
            } else {
                document.getElementById('pingValue').textContent = '--';
                document.getElementById('downloadSpeed').textContent = 'â†“ --';
                document.getElementById('uploadSpeed').textContent = 'â†‘ --';
                document.getElementById('dataUsage').textContent = '--';
            }
        }, 2000);
    }

    // ====== Events ======
    function setupEventListeners() {
        setupTabs();

        // Header quick nav
        const goSettingsBtn = document.getElementById('goSettingsBtn');
        if (goSettingsBtn) goSettingsBtn.addEventListener('click', ()=> switchTab('settings'));
        const goToolsBtn = document.getElementById('goToolsBtn');
        if (goToolsBtn) goToolsBtn.addEventListener('click', ()=> switchTab('tools'));

        // Connect
        document.getElementById('connectBtn').addEventListener('click', quickConnect);

        // Top desktop buttons
        document.getElementById('pingAllBtn').addEventListener('click', ()=>testAllPings());
        document.getElementById('cleanupBtn').addEventListener('click', ()=>cleanupInactiveServers());
        document.getElementById('shareAllBtn').addEventListener('click', ()=>shareAllConfigs());
        document.getElementById('shareActiveBtn').addEventListener('click', ()=>shareActiveConfigs());
        document.getElementById('clipboardBtn').addEventListener('click', ()=>importFromClipboard());
        document.getElementById('selectModeBtn').addEventListener('click', ()=>toggleSelectMode());
        document.getElementById('deleteAllBtn').addEventListener('click', ()=>deleteAllInScope());
        document.getElementById('addConfigBtn').addEventListener('click', ()=>toggleModal('addConfigModal', true));
        document.getElementById('createFolderBtn').addEventListener('click', createFolder);

        // Bulk menu (mobile)
        document.getElementById('bulkMenuBtn').addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            openBulkMenu(e.currentTarget);
        });

        // Selection bar actions
        document.getElementById('deleteSelectedBtn').addEventListener('click', ()=>deleteSelected());
        document.getElementById('shareSelectedBtn').addEventListener('click', ()=>shareAllConfigs());
        document.getElementById('pingSelectedBtn').addEventListener('click', ()=>testAllPings(getSelectedOrScopeConfigs()));
        document.getElementById('moveToFolderBtn').addEventListener('click', ()=>moveSelectedToFolder());

        // Add config modal
        document.getElementById('cancelConfigBtn').addEventListener('click', ()=>toggleModal('addConfigModal', false));
        document.getElementById('saveConfigBtn').addEventListener('click', ()=>{
            const val=document.getElementById('configUrl').value.trim();
            if(!val) return showToast('Ù…ØªÙ† Ø®Ø§Ù„ÛŒ Ø§Ø³Øª','info');
            const lines=val.split('\n').map(l=>l.trim()).filter(Boolean);
            let added=0; lines.forEach(l=>{ if (addConfigFromUrl(l, currentFolderId)) added++; });
            document.getElementById('configUrl').value=''; toggleModal('addConfigModal', false);
            showToast(added+' Ú©Ø§Ù†ÙÛŒÚ¯ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯','success');
        });

        // Settings quick actions
        document.getElementById('settingsImportClipboard').addEventListener('click', ()=>importFromClipboard());
        document.getElementById('settingsExport').addEventListener('click', ()=>exportBackup());
        document.getElementById('settingsImportFile').addEventListener('change', (e)=>importBackupFromFile(e.target.files));

        // Tools
        document.getElementById('speedTestBtn').addEventListener('click', ()=>{ if(!isConnected) return showToast('Ø§Ø¨ØªØ¯Ø§ Ø§ØªØµØ§Ù„ Ø±Ø§ Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†ÛŒØ¯','info'); showToast('Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ø³Ø±Ø¹Øª...','info'); setTimeout(()=>showToast('Ù†ØªÛŒØ¬Ù‡: â†“ '+(Math.random()*120+20).toFixed(1)+' Mbps â€¢ â†‘ '+(Math.random()*50+10).toFixed(1)+' Mbps','success'), 1500); });
        document.getElementById('pingTestToolBtn').addEventListener('click', ()=> testAllPings());
        document.getElementById('scanQrBtnTools').addEventListener('click', ()=> startQrScan('qrRegion'));
        document.getElementById('qrFileInputTools').addEventListener('change', (e)=>{ const f=e.target.files && e.target.files[0]; if (f) handleQrFile(f); });

        // QR modal close
        document.getElementById('closeQrBtn').addEventListener('click', ()=> stopQrScan());
    }

    // ====== Render All ======
    function renderAll() {
        renderFolderBar();
        renderConfigs();
    }

    // ====== Connection Duration Timer (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ - Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø§Ù†ØªÙ‡Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø§ØµÙ„ÛŒ Ø¨Ø§Ø´Ø¯) ======
    // ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø§Ø² Ø§Ø¨ØªØ¯Ø§ÛŒ ÙØ§ÛŒÙ„ Ø­Ø°Ù Ø´Ø¯Ù‡ Ø¨ÙˆØ¯ Ùˆ Ø§Ù„Ø§Ù† Ø¯Ø± Ø¬Ø§ÛŒ ØµØ­ÛŒØ­ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯.
    let connectionTimer = null;
    let connectionStartTime = null;

    function startConnectionTimer() {
        connectionStartTime = Date.now();
        const el = document.getElementById('connectionDuration');
        if (!el) return;
        el.classList.remove('hidden');
        connectionTimer = setInterval(() => {
            const diff = Math.floor((Date.now() - connectionStartTime) / 1000);
            let h = Math.floor(diff / 3600);
            let m = Math.floor((diff % 3600) / 60);
            let s = diff % 60;
            let text = '';
            if (h > 0) {
                text = `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            } else if (m > 0) {
                text = `${m}:${String(s).padStart(2,'0')}`;
            } else {
                text = `${s} Ø«Ø§Ù†ÛŒÙ‡`;
            }
            el.textContent = "â± Ù…Ø¯Øª Ø§ØªØµØ§Ù„: " + text;
        }, 1000);
    }

    function stopConnectionTimer() {
        if (connectionTimer) clearInterval(connectionTimer);
        const el = document.getElementById('connectionDuration');
        if (el) {
            el.textContent = "â± Ù…Ø¯Øª Ø§ØªØµØ§Ù„: 00:00";
            el.classList.add('hidden');
        }
    }

    // Modify updateConnectionStatus to start/stop timer
    const oldUpdateConnectionStatus = updateConnectionStatus;
    updateConnectionStatus = function() {
        oldUpdateConnectionStatus();
        if (isConnected && currentConfig) {
            startConnectionTimer();
        } else {
            stopConnectionTimer();
        }
    };

    // ====== About Section Setup (Ú©Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ù…Ø§) ======
    function setupAboutSection() {
        const aboutBtn = document.getElementById('aboutBtn');
        const aboutModal = document.getElementById('aboutModal');
        const closeAboutModalBtn = document.getElementById('closeAboutModalBtn');
        const aboutPanel = document.getElementById('aboutPanel');
        const aboutContentMobile = document.getElementById('aboutContentMobile');
        const aboutContentDesktop = document.getElementById('aboutContentDesktop');

        // Ù…ØªÙ† Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙ…Ø§Ø³
        const aboutText = `
            <p class="mb-2">Ø¨Ø§ Ø³Ù„Ø§Ù… Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¹Ø²ÛŒØ²</p>
            <p class="mb-2">Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ú©Ù¾ÛŒ Ø¨Ø±Ø¯Ø§Ø±ÛŒ Ø§Ø² Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ùˆ Ø¸Ø§Ù‡Ø± Ú©Ø§Ø±Ø¨Ø±ÛŒ ØºÛŒØ± Ù‚Ø§Ù†ÙˆÙ†ÛŒ Ùˆ Ø­Ø±Ø§Ù… Ø§Ø³Øª</p>
            <p class="mb-2">Ú†Ø±Ø§ Ú©Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø®Øª Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªÙ„Ø§Ø´ Ù‡Ø§ÛŒ Ù…Ø³ØªÙ…Ø± Ùˆ Ø§Ø±Ø²Ø´Ù…Ù†Ø¯ÛŒ ØµØ±Ù Ø´Ø¯Ù‡</p>
            <p class="mb-2">Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ù‡ ÙÚ©Ø± Ø³Ø§Ø®Øª ÙÛŒÙ„ØªØ±Ø´Ú©Ù† ÛŒØ§ Ø¨Ù‡Ø±Ù‡ Ø¨Ø±Ø¯Ø§Ø±ÛŒ Ù…Ø§Ù„ÛŒ Ø§Ø² ØªØ­Ø±ÛŒÙ… Ù‡Ø§ÛŒ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ Ù†Ø¨ÙˆØ¯Ù‡</p>
            <p class="mb-2">Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø§Ø¨Ø²Ø§Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³Ø±ÙˆØ± Ù‡Ø§ Ùˆ Ú©Ø§Ù†ÙÛŒÚ¯ Ù‡Ø§ÛŒ ÙˆÛŒ ØªÙˆ Ø±ÛŒ Ù‡Ø³ØªØ´ Ùˆ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ø³Ø±ÙˆØ±ÛŒ Ø¯Ø± Ø¯Ø§Ø®Ù„ ÛŒØ§ Ø®Ø§Ø±Ø¬ Ú©Ø´ÙˆØ± Ø§ÛŒØ±Ø§Ù† Ù…ØªØµÙ„ Ù†Ù…ÛŒØ¨Ø§Ø´Ø¯</p>
            <p class="mb-2">Ø¨Ù‡ ØªØ¨Ø¹ÛŒØª Ø§Ø² Ù‚ÙˆØ§Ù†ÛŒÙ† Ø¬Ù…Ù‡ÙˆØ±ÛŒ Ø§Ø³Ù„Ø§Ù…ÛŒ Ø§ÛŒØ±Ø§Ù† ÙØ±ÙˆØ´ Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù‡Ø± Ú©Ø§Ø±Ø¨Ø± Ùˆ Ù‡Ø± Ø§Ù†Ø³Ø§Ù†ÛŒ Ø¯Ø± Ø³Ø±ØªØ§Ø³Ø± Ø¯Ù†ÛŒØ§ Ø¬Ø±Ù… ÙˆØ­Ø±Ø§Ù… Ù…ÛŒØ¨Ø§Ø´Ø¯</p>
            <p class="mb-2">Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø§ÛŒÙ† Ø¨Ø±Ù†Ø§Ù…Ù‡  Ø§Ø² Ø§Ù‡Ø¯Ø§ÙÛŒ Ù…Ø§Ù†Ù†Ø¯ Ø¯Ø´Ù…Ù†ÛŒ Ø¨Ø§ ÙˆØ²Ø§Ø±Øª Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ø¬Ù…Ù‡ÙˆØ±ÛŒ Ø§Ø³Ù„Ø§Ù…ÛŒ Ø§ÛŒØ±Ø§Ù† Ù†Ø¯Ø§Ø´ØªÙ‡ Ùˆ Ù‡ÛŒÚ†Ú¯ÙˆÙ†Ù‡ Ù¾ÛŒØ±ÙˆÛŒ Ø§Ø² ØªÙˆØªØ¹Ù‡ Ù‡Ø§ÛŒ Ø¯Ø´Ù…Ù†Ø§Ù† Ø³Ø±Ø²Ù…ÛŒÙ† ØªØ§Ø±ÛŒØ®ÛŒ Ùˆ ÙØ±Ù‡Ù†Ú¯ÛŒ Ø§ÛŒØ±Ø§Ù† Ù†Ø¯Ø§Ø±Ø¯ Ùˆ Ù†Ø®ÙˆØ§Ù‡Ø¯ Ø¯Ø§Ø´Øª.</p>
            <p class="mb-2">Ø¯Ø±ÙˆØ¯ Ø¨Ø± ØªÙ…Ø§Ù… Ù…Ø±Ø¯Ù… ÙˆØ·Ù† Ø¯ÙˆØ³Øª Ùˆ ÙˆØ·Ù† Ù¾Ø±Ø³Øª Ø§ÛŒØ±Ø§Ù† Ùˆ Ø¬Ù‡Ø§Ù†.</p>
            <p class="mb-2">Ø¯Ø± Ù‡Ù…ÛŒÙ† Ù„Ø­Ø¸Ù‡ ÙÙ‚Ø· Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ù…Ø§ Ø¯Ø± ÙØ¶Ø§ÛŒ Ù…Ø¬Ø§Ø²ÛŒ ØªÙ†Ù‡Ø§ Ø¯Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ØªÙ„Ú¯Ø±Ø§Ù… Ùˆ Ø§ÛŒÙ…Ù„ Ù…ÙˆØ¬ÙˆØ¯ Ù…ÛŒØ¨Ø§Ø´Ø¯</p>
            <p class="mt-4">------------</p>
            <p class="mt-4">Ø§ÛŒÙ…ÛŒÙ„: <a href="mailto:mahdiashuori1@gmail.com" class="text-blue-400 hover:underline"><br>mahdiashuori1@gmail.com</a></p>
            <p style="direction: ltr; text-align: right">ØªÙ„Ú¯Ø±Ø§Ù…: <a href="https://t.me/mahdi_ashuori" target="_blank" class="text-blue-400 hover:underline"><br>@mahdi_ashuori</a></p>
        `;

        // ØªØ§Ø¨Ø¹ÛŒ Ú©Ù‡ Ù†Ø­ÙˆÙ‡ Ù†Ù…Ø§ÛŒØ´ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù†Ø¯Ø§Ø²Ù‡ ØµÙØ­Ù‡ Ùˆ Ú©Ù„ÛŒÚ© Ú©Ø§Ø±Ø¨Ø± ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯
        function handleAboutClick() {
            if (window.innerWidth < 4000) {
                // Ù…ÙˆØ¨Ø§ÛŒÙ„: Ù†Ù…Ø§ÛŒØ´ Ù…ÙˆØ¯Ø§Ù„
                aboutContentMobile.innerHTML = aboutText;
                toggleModal('aboutModal', true); // Ø§Ø² ØªØ§Ø¨Ø¹ Ù…ÙˆØ¬ÙˆØ¯ toggleModal Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            } else {
                // Ø¯Ø³Ú©ØªØ§Ù¾: Ø¨Ø§Ø²/Ø¨Ø³ØªÙ‡ Ú©Ø±Ø¯Ù† Ù¾Ù†Ù„ Ú©Ø´ÙˆÛŒÛŒ
                const isCurrentlyVisible = !aboutPanel.classList.contains('hidden');
                if (isCurrentlyVisible) {
                    aboutPanel.classList.add('hidden');
                } else {
                    aboutContentDesktop.innerHTML = aboutText;
                    aboutPanel.classList.remove('hidden');
                }
            }
        }

        // Ø§ÙØ²ÙˆØ¯Ù† event listener Ø¨Ù‡ Ø¯Ú©Ù…Ù‡
        aboutBtn.addEventListener('click', handleAboutClick);

        // Ø§ÙØ²ÙˆØ¯Ù† event listener Ø¨Ù‡ Ø¯Ú©Ù…Ù‡ Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„
        closeAboutModalBtn.addEventListener('click', () => toggleModal('aboutModal', false));

        // Ø§Ø®ØªÛŒØ§Ø±ÛŒ: Ø¨Ø³ØªÙ† Ù…ÙˆØ¯Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
        aboutModal.addEventListener('click', (e) => {
            if (e.target === aboutModal) {
                toggleModal('aboutModal', false);
            }
        });
    }

    // ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ ØªØ§Ø¨Ø¹ setupAboutSection Ø¯Ø± Ø¯Ø§Ø®Ù„ ØªØ§Ø¨Ø¹ init
    // ØªÙˆØ¬Ù‡: Ø§ÛŒÙ† Ø®Ø· Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø¬Ø§ÛŒÛŒ Ø§Ø² ØªØ§Ø¨Ø¹ init Ù‚Ø±Ø§Ø± Ú¯ÛŒØ±Ø¯ØŒ Ù…Ø«Ù„Ø§Ù‹ Ø¨Ø¹Ø¯ Ø§Ø² setupEventListeners();
    // Ø´Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø§ÛŒÙ† Ø®Ø· Ø±Ø§ Ø¨Ù‡ ØªØ§Ø¨Ø¹ init Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯:
    // setupAboutSection();

    /* ------------ ØªØ³Øª Ø³Ø±Ø¹Øª Ø§ÛŒÙ†ØªØ±Ù†Øª ÙˆØ§Ù‚Ø¹ÛŒ (Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„) ------------ */
    (()=>{
        const startBtn=document.getElementById('netSpeedTestBtn');
        const resultBox=document.getElementById('netSpeedResult');
        const downEl=document.getElementById('downMbps');
        const upEl=document.getElementById('upMbps');
        const pingEl=document.getElementById('pingMs');
        if(!startBtn) return;

        startBtn.addEventListener('click',async()=>{
            startBtn.disabled=true;
            startBtn.textContent='Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...';
            resultBox.classList.add('hidden');

            try{
                // ØªØ§Ø¨Ø¹ ØªØ³Øª Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Image-clock + XMLHttpRequest
                const testUrl='https://cachefly.cachefly.net/10mb.test'; // ÙØ§ÛŒÙ„ 10 Ù…Ú¯Ø§Ø¨Ø§ÛŒØª
                const pingUrl='https://cachefly.cachefly.net/1kb.test';  // ÙØ§ÛŒÙ„ Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÙ†Ú¯

                // Ù¾ÛŒÙ†Ú¯ Ø³Ø§Ø¯Ù‡
                const t0=performance.now();
                await fetch(pingUrl,{mode:'no-cors'});
                const ping=Math.round(performance.now()-t0);

                // Ø¯Ø§Ù†Ù„ÙˆØ¯
                const tDown=performance.now();
                await fetch(testUrl,{mode:'no-cors'});
                const downDur=(performance.now()-tDown)/1000; // Ø«Ø§Ù†ÛŒÙ‡
                const downMbps=Math.round(10*8/downDur);

                // Ø¢Ù¾Ù„ÙˆØ¯ (Ø¨Ø§ Ø§Ø±Ø³Ø§Ù„ blob 2 Ù…Ú¯Ø§Ø¨Ø§ÛŒØªÛŒ)
                const uploadBlob=new Blob([new Uint8Array(2*1024*1024)]);
                const tUp=performance.now();
                await fetch('https://cachefly.cachefly.net/empty.test',{
                    method:'POST',body:uploadBlob,mode:'no-cors'
                });
                const upDur=(performance.now()-tUp)/1000;
                const upMbps=Math.round(2*8/upDur);

                // Ù†Ù…Ø§ÛŒØ´
                downEl.textContent=downMbps;
                upEl.textContent=upMbps;
                pingEl.textContent=ping;
                resultBox.classList.remove('hidden');
            }catch(e){
                downEl.textContent='Ø®Ø·Ø§';upEl.textContent='--';pingEl.textContent='--';
                resultBox.classList.remove('hidden');
            }finally{
                startBtn.disabled=false;
                startBtn.textContent='Ø´Ø±ÙˆØ¹ ØªØ³Øª Ø³Ø±Ø¹Øª';
            }
        });
    })();


</script>
</body>
</html>
